# Visit https://github.com/lowlighter/metrics#-documentation for full reference
name: Metrics
on:
  # Schedule updates (“At 00:00.”)
  schedule:
    # "0 0 * * *" (UTC) = "0 1 * * *" (Germany)
    - cron: "0 0 * * *"
  # push:
  #   branches: ["dev", "main"]
  workflow_dispatch:

jobs:
  Personal:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Personal
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          filename: .github/metrics/personal.svg

          # Options
          user: dennykorsukewitz
          template: classic
          base: header, activity, community, repositories, metadata
          config_display: large
          config_timezone: Europe/Berlin
          plugin_habits: yes
          plugin_habits_charts_type: classic
          plugin_habits_days: 14
          plugin_habits_facts: yes
          plugin_habits_from: 200
          plugin_habits_languages_limit: 8
          plugin_habits_languages_threshold: 0%
          plugin_introduction: yes
          plugin_introduction_title: yes
          # plugin_isocalendar: yes
          # plugin_isocalendar_duration: full-year
          plugin_calendar: yes
          plugin_calendar_limit: 1
          plugin_languages: yes
          plugin_languages_analysis_timeout: 15
          plugin_languages_analysis_timeout_repositories: 7.5
          plugin_languages_categories: markup, programming
          plugin_languages_colors: github
          plugin_languages_limit: 8
          plugin_languages_recent_categories: markup, programming
          plugin_languages_recent_days: 14
          plugin_languages_recent_load: 300
          plugin_languages_sections: most-used
          plugin_languages_threshold: 0%
          plugin_people: yes
          plugin_people_limit: 24
          plugin_people_size: 28
          plugin_people_types: followers, following
          plugin_repositories: yes
          plugin_repositories_featured: znuny/znuny, karldaeubel/PenAndPaperFloorplanner, zammad/zammad
          plugin_repositories_order: featured, pinned, starred, random

  Languages:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Languages Indepth
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          filename: .github/metrics/languages.indepth.svg

          # Options
          base: ""
          plugin_languages: yes
          plugin_languages_ignored: >-
            tex, less, dockerfile, makefile, qmake, lex, cmake,
            gnuplot
          plugin_languages_indepth: yes
          plugin_languages_details: lines, bytes-size, percentage
          plugin_languages_limit: 8
          plugin_languages_analysis_timeout: 60

  Commit-Calendar-Isometric:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Full-year calendar
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          filename: .github/metrics/commit-calendar.isometric.svg
          base: ""
          plugin_isocalendar: yes
          plugin_isocalendar_duration: full-year

  Commit-Calendar-Flat:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Commit current year calendar
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          filename: .github/metrics/commit-calendar.current.svg

          # Options
          base: ""
          plugin_calendar: yes

      - name: Commit current year calendar
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          filename: .github/metrics/commit-calendar.total.svg

          # Options
          base: ""
          plugin_calendar: yes
          plugin_calendar_limit: 0

  Comment-Reactions:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Comment Reactions
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          filename: .github/metrics/comment.reactions.svg

          # Options
          base: ""
          plugin_reactions: yes
          plugin_reactions_limit: 1000
          plugin_reactions_limit_issues: 1000
          plugin_reactions_limit_discussions: 1000
          plugin_reactions_limit_discussions_comments: 1000
          plugin_reactions_details: percentage

  Sponsors:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Sponsors
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          filename: .github/metrics/sponsors.svg

          # Options
          base: ""
          plugin_sponsors: yes
          plugin_sponsors_sections: goal, about, list
          plugin_sponsors_past: yes
          plugin_sponsors_title: "Sponsor Me!"

  Stargazers:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Stargazers graph
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          filename: .github/metrics/stargazers.graph.svg

          # Options
          base: ""
          plugin_stargazers: yes
          plugin_stargazers_charts: yes
          plugin_stargazers_days: 0
          plugin_stargazers_charts_type: graph

  Daily:
    runs-on: ubuntu-latest
    needs: [Stargazers]
    if: ${{ always() }}
    permissions:
      contents: write
    env:
      GH_TOKEN: ${{ github.token }}
      VSC_PAT: ${{ secrets.VSC_PAT }}
    steps:
      - name: Checkout dennykorsukewitz
        uses: actions/checkout@v4
        env:
          fetch-depth: "1"
      - name: Get Daily data
        run: ./.github/workflows/metrics/daily.sh
      - name: Git Pull
        run: git pull
      - name: Add and Commit
        uses: EndBug/add-and-commit@v9
        with:
          message: "Updated Metrics: Daily Data."

  Stars:
    runs-on: ubuntu-latest
    needs: [Daily]
    if: ${{ always() }}
    permissions:
      contents: write
    env:
      GH_TOKEN: ${{ github.token }}
    steps:
      - name: Checkout dennykorsukewitz
        uses: actions/checkout@v4
        env:
          fetch-depth: "1"
      - name: Get GitHub data
        run: ./.github/workflows/metrics/github.sh
      - name: Git Pull
        run: git pull
      - name: Add and Commit
        uses: EndBug/add-and-commit@v9
        with:
          message: "Updated Metrics: GitHub Data."

  Sublime:
    runs-on: ubuntu-latest
    needs: [Stars]
    if: ${{ always() }}
    permissions:
      contents: write
    env:
      GH_TOKEN: ${{ github.token }}
    steps:
      - name: Checkout dennykorsukewitz
        uses: actions/checkout@v4
        env:
          fetch-depth: "1"
      - name: Get Sublime data
        run: ./.github/workflows/metrics/sublime.sh
      - name: Git Pull
        run: git pull
      - name: Add and Commit
        uses: EndBug/add-and-commit@v9
        with:
          message: "Updated Metrics: Sublime Data."

  VSCode:
    runs-on: ubuntu-latest
    needs: [Sublime]
    if: ${{ always() }}
    permissions:
      contents: write
    env:
      GH_TOKEN: ${{ github.token }}
      VSC_PAT: ${{ secrets.VSC_PAT }}
    steps:
      - name: Checkout dennykorsukewitz
        uses: actions/checkout@v4
        env:
          fetch-depth: "1"
      - name: Get VSCode data
        run: ./.github/workflows/metrics/vscode.sh
      - name: Git Pull
        run: git pull
      - name: Add and Commit
        uses: EndBug/add-and-commit@v9
        with:
          message: "Updated Metrics: VSCode Data."
